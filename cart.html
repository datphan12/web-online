<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
            crossorigin="anonymous"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
        />
        <title>PhoneHub - Shopping Cart</title>
        <link rel="stylesheet" href="./css/styles.css" />
        <style>
            .cart-container {
                min-height: 60vh;
                padding: 2rem 0;
            }

            .cart-item {
                border: 1px solid #e0e0e0;
                border-radius: 12px;
                padding: 20px;
                margin-bottom: 20px;
                background: white;
                transition: all 0.3s ease;
            }

            .cart-item:hover {
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                transform: translateY(-2px);
            }

            .cart-item img {
                width: 80px;
                height: 80px;
                object-fit: cover;
                border-radius: 8px;
            }

            .quantity-controls {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .quantity-btn {
                background: #f8f9fa;
                border: 1px solid #dee2e6;
                width: 35px;
                height: 35px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .quantity-btn:hover {
                background: #e9ecef;
                transform: scale(1.1);
            }

            .quantity-input {
                width: 60px;
                text-align: center;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                padding: 5px;
            }

            .cart-summary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 15px;
                padding: 25px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            }

            .summary-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 15px;
                font-size: 16px;
            }

            .summary-total {
                border-top: 2px solid rgba(255, 255, 255, 0.2);
                padding-top: 15px;
                font-size: 20px;
                font-weight: bold;
            }

            .btn-checkout {
                background: linear-gradient(45deg, #ff6b6b, #ffa500);
                border: none;
                color: white;
                padding: 12px 30px;
                border-radius: 25px;
                font-weight: 600;
                transition: all 0.3s ease;
                width: 100%;
                margin-top: 20px;
            }

            .btn-checkout:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
                color: white;
            }

            .empty-cart {
                text-align: center;
                padding: 60px 20px;
                color: #6c757d;
            }

            .empty-cart i {
                font-size: 4rem;
                margin-bottom: 20px;
                color: #dee2e6;
            }

            .bill-modal .modal-content {
                border-radius: 15px;
                border: none;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }

            .bill-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 15px 15px 0 0;
                padding: 25px;
                text-align: center;
            }

            .bill-item {
                border-bottom: 1px solid #f1f3f4;
                padding: 15px 0;
            }

            .bill-item:last-child {
                border-bottom: none;
            }

            .bill-total {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 20px;
                margin-top: 20px;
                border: 2px solid #e9ecef;
            }

            .back-to-shop {
                position: fixed;
                top: 20px;
                left: 20px;
                z-index: 1000;
                background: linear-gradient(45deg, #667eea, #764ba2);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 25px;
                text-decoration: none;
                transition: all 0.3s ease;
            }

            .back-to-shop:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
                color: white;
            }
        </style>
    </head>
    <body>
        <!-- Back to Shop Button -->
        <a href="index.html" class="back-to-shop">
            <i class="fas fa-arrow-left me-2"></i>Back to Shop
        </a>

        <!-- Header -->
        <header>
            <nav class="navbar navbar-expand-lg bg-body-tertiary px-5">
                <div class="container-fluid">
                    <a class="navbar-brand" href="index.html">
                        <img
                            src="./assets/logo.png"
                            alt="logo"
                            style="width: 60px"
                        />
                    </a>

                    <div class="d-flex align-items-center">
                        <h4 class="mb-0 me-4">
                            <i class="fas fa-shopping-cart me-2"></i>Shopping
                            Cart
                        </h4>

                        <!-- User Section -->
                        <div class="user-section" id="userSection">
                            <div class="user-dropdown">
                                <button
                                    class="user-info"
                                    onclick="toggleUserDropdown()"
                                >
                                    <i class="fas fa-user me-2"></i>
                                    <span id="userName">Hello, User</span>
                                    <i class="fas fa-chevron-down ms-2"></i>
                                </button>
                                <div
                                    class="dropdown-menu-custom"
                                    id="userDropdown"
                                >
                                    <a href="#" class="dropdown-item-custom">
                                        <i class="fas fa-user me-2"></i>Profile
                                    </a>
                                    <a href="#" class="dropdown-item-custom">
                                        <i class="fas fa-shopping-bag me-2"></i
                                        >My Orders
                                    </a>
                                    <a
                                        href="#"
                                        class="dropdown-item-custom"
                                        onclick="logout()"
                                    >
                                        <i class="fas fa-sign-out-alt me-2"></i
                                        >Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="cart-container">
            <div class="container">
                <div class="row">
                    <!-- Cart Items -->
                    <div class="col-lg-8">
                        <div id="cartItems">
                            <!-- Cart items will be rendered here -->
                        </div>
                    </div>

                    <!-- Cart Summary -->
                    <div class="col-lg-4">
                        <div class="cart-summary">
                            <h4 class="mb-4">
                                <i class="fas fa-receipt me-2"></i>Order Summary
                            </h4>

                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="subtotal">$0.00</span>
                            </div>

                            <div class="summary-row">
                                <span>Shipping:</span>
                                <span id="shipping">$0.00</span>
                            </div>

                            <div class="summary-row">
                                <span>Tax (10%):</span>
                                <span id="tax">$0.00</span>
                            </div>

                            <div class="summary-row summary-total">
                                <span>Total:</span>
                                <span id="total">$0.00</span>
                            </div>

                            <button
                                class="btn-checkout"
                                onclick="showCheckoutBill()"
                            >
                                <i class="fas fa-credit-card me-2"></i>Proceed
                                to Checkout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bill Modal -->
        <div
            class="modal fade bill-modal"
            id="billModal"
            tabindex="-1"
            aria-labelledby="billModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="bill-header">
                        <h3 class="mb-0">
                            <i class="fas fa-file-invoice-dollar me-2"></i>Order
                            Invoice
                        </h3>
                        <p class="mb-0 mt-2">Thank you for your purchase!</p>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h6><strong>Bill To:</strong></h6>
                                <p class="mb-0" id="billCustomerName">
                                    John Doe
                                </p>
                                <p class="mb-0" id="billCustomerEmail">
                                    john@example.com
                                </p>
                                <p class="mb-0">
                                    Order Date: <span id="billDate"></span>
                                </p>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <h6><strong>Invoice #:</strong></h6>
                                <p class="mb-0" id="billInvoiceNumber">
                                    INV-001
                                </p>
                            </div>
                        </div>

                        <div class="bill-items" id="billItems">
                            <!-- Bill items will be rendered here -->
                        </div>

                        <div class="bill-total">
                            <div class="row">
                                <div class="col-md-8">
                                    <h5><strong>Order Total</strong></h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-flex justify-content-between">
                                        <span>Subtotal:</span>
                                        <span id="billSubtotal">$0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Shipping:</span>
                                        <span id="billShipping">$0.00</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Tax:</span>
                                        <span id="billTax">$0.00</span>
                                    </div>
                                    <hr />
                                    <div class="d-flex justify-content-between">
                                        <strong>Total:</strong>
                                        <strong id="billTotal">$0.00</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            <i class="fas fa-times me-2"></i>Close
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="printBill()"
                        >
                            <i class="fas fa-print me-2"></i>Print Invoice
                        </button>
                        <button
                            type="button"
                            class="btn btn-success"
                            onclick="confirmOrder()"
                        >
                            <i class="fas fa-check me-2"></i>Confirm Order
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <h5><i class="fas fa-mobile-alt me-2"></i>PhoneHub</h5>
                        <p class="mb-3">
                            Your trusted partner for premium smartphones and
                            mobile accessories. We bring you the latest
                            technology at competitive prices.
                        </p>
                        <div class="social-icons">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                    <div class="col-md-2 mb-4">
                        <h5>Quick Links</h5>
                        <ul class="list-unstyled">
                            <li><a href="index.html">Home</a></li>
                            <li><a href="#">Products</a></li>
                            <li><a href="#">About Us</a></li>
                            <li><a href="#">Contact</a></li>
                        </ul>
                    </div>
                    <div class="col-md-2 mb-4">
                        <h5>Categories</h5>
                        <ul class="list-unstyled">
                            <li><a href="#">iPhone</a></li>
                            <li><a href="#">Samsung</a></li>
                            <li><a href="#">Xiaomi</a></li>
                            <li><a href="#">Accessories</a></li>
                        </ul>
                    </div>
                    <div class="col-md-2 mb-4">
                        <h5>Support</h5>
                        <ul class="list-unstyled">
                            <li><a href="#">Help Center</a></li>
                            <li><a href="#">Warranty</a></li>
                            <li><a href="#">Returns</a></li>
                            <li><a href="#">Shipping</a></li>
                        </ul>
                    </div>
                    <div class="col-md-2 mb-4">
                        <h5>Account</h5>
                        <ul class="list-unstyled">
                            <li><a href="#">Sign In</a></li>
                            <li><a href="#">Register</a></li>
                            <li><a href="#">My Orders</a></li>
                            <li><a href="#">Wishlist</a></li>
                        </ul>
                    </div>
                </div>
                <hr class="my-4" />
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="mb-0">
                            &copy; 2025 PhoneHub. All rights reserved.
                        </p>
                    </div>
                    <div class="col-md-6 text-md-end">
                        <p class="mb-0">
                            <a href="#" class="me-3">Privacy Policy</a>
                            <a href="#" class="me-3">Terms of Service</a>
                            <a href="#">Cookie Settings</a>
                        </p>
                    </div>
                </div>
            </div>
        </footer>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
            crossorigin="anonymous"
        ></script>

        <script src="./js/script.js"></script>
        <script>
            // Cart-specific functionality
            document.addEventListener("DOMContentLoaded", function () {
                checkUserSession();
                renderCartItems();
                updateCartSummary();

                // If user is not logged in, redirect to home
                if (!currentUser) {
                    window.location.href = "index.html";
                }
            });

            function renderCartItems() {
                const cartItemsContainer = document.getElementById("cartItems");

                if (productInCart.length === 0) {
                    cartItemsContainer.innerHTML = `
                        <div class="empty-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <h3>Your cart is empty</h3>
                            <p>Looks like you haven't added any items to your cart yet.</p>
                            <a href="index.html" class="btn btn-primary">
                                <i class="fas fa-shopping-bag me-2"></i>Continue Shopping
                            </a>
                        </div>
                    `;
                    return;
                }

                const cartHTML = productInCart
                    .map(
                        (product, index) => `
                    <div class="cart-item">
                        <div class="row align-items-center">
                            <div class="col-md-2">
                                <img src="${product.image}" alt="${
                            product.name
                        }" class="img-fluid">
                            </div>
                            <div class="col-md-4">
                                <h6 class="mb-1">${product.name}</h6>
                                <small class="text-muted">${getBrandDisplayName(
                                    product.brand
                                )}</small>
                                <div class="product-features mt-2">
                                    ${product.features
                                        .slice(0, 2)
                                        .map(
                                            (feature) =>
                                                `<small class="badge bg-light text-dark me-1">${feature}</small>`
                                        )
                                        .join("")}
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="quantity-controls">
                                    <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <input type="number" class="quantity-input" value="${
                                        product.quantity || 1
                                    }" 
                                           onchange="setQuantity(${index}, this.value)" min="1">
                                    <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2 text-center">
                                <div class="h5 mb-0">$${product.price}</div>
                                ${
                                    product.originalPrice
                                        ? `<small class="text-muted text-decoration-line-through">$${product.originalPrice}</small>`
                                        : ""
                                }
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-outline-danger btn-sm" onclick="removeFromCart(${index})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `
                    )
                    .join("");

                cartItemsContainer.innerHTML = cartHTML;
            }

            function updateQuantity(index, change) {
                if (productInCart[index]) {
                    const currentQuantity = productInCart[index].quantity || 1;
                    const newQuantity = Math.max(1, currentQuantity + change);
                    productInCart[index].quantity = newQuantity;
                    renderCartItems();
                    updateCartSummary();
                }
            }

            function setQuantity(index, quantity) {
                const qty = Math.max(1, parseInt(quantity) || 1);
                if (productInCart[index]) {
                    productInCart[index].quantity = qty;
                    updateCartSummary();
                }
            }

            function removeFromCart(index) {
                if (
                    confirm(
                        "Are you sure you want to remove this item from your cart?"
                    )
                ) {
                    productInCart.splice(index, 1);
                    renderCartItems();
                    updateCartSummary();
                    showNotification("Item removed from cart!", "info");
                }
            }

            function updateCartSummary() {
                const subtotal = productInCart.reduce((sum, product) => {
                    return sum + product.price * (product.quantity || 1);
                }, 0);

                const shipping = subtotal > 500 ? 0 : 25; // Free shipping over $500
                const tax = subtotal * 0.1; // 10% tax
                const total = subtotal + shipping + tax;

                document.getElementById(
                    "subtotal"
                ).textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById("shipping").textContent =
                    shipping === 0 ? "FREE" : `$${shipping.toFixed(2)}`;
                document.getElementById("tax").textContent = `$${tax.toFixed(
                    2
                )}`;
                document.getElementById(
                    "total"
                ).textContent = `$${total.toFixed(2)}`;
            }

            function showCheckoutBill() {
                if (productInCart.length === 0) {
                    showNotification("Your cart is empty!", "warning");
                    return;
                }

                // Update bill modal content
                const now = new Date();
                const invoiceNumber =
                    "INV-" + now.getTime().toString().slice(-6);

                document.getElementById("billCustomerName").textContent =
                    currentUser.name;
                document.getElementById("billCustomerEmail").textContent =
                    currentUser.email;
                document.getElementById("billDate").textContent =
                    now.toLocaleDateString();
                document.getElementById("billInvoiceNumber").textContent =
                    invoiceNumber;

                // Render bill items
                const billItemsContainer = document.getElementById("billItems");
                const billItemsHTML = productInCart
                    .map((product) => {
                        const quantity = product.quantity || 1;
                        const itemTotal = product.price * quantity;

                        return `
                        <div class="bill-item">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-1">${product.name}</h6>
                                    <small class="text-muted">${getBrandDisplayName(
                                        product.brand
                                    )}</small>
                                </div>
                                <div class="col-md-2 text-center">
                                    <span>$${product.price.toFixed(2)}</span>
                                </div>
                                <div class="col-md-2 text-center">
                                    <span>×${quantity}</span>
                                </div>
                                <div class="col-md-2 text-end">
                                    <strong>$${itemTotal.toFixed(2)}</strong>
                                </div>
                            </div>
                        </div>
                    `;
                    })
                    .join("");

                billItemsContainer.innerHTML = `
                    <div class="row mb-3">
                        <div class="col-md-6"><strong>Item</strong></div>
                        <div class="col-md-2 text-center"><strong>Price</strong></div>
                        <div class="col-md-2 text-center"><strong>Qty</strong></div>
                        <div class="col-md-2 text-end"><strong>Total</strong></div>
                    </div>
                    ${billItemsHTML}
                `;

                // Update bill totals
                const subtotal = productInCart.reduce(
                    (sum, product) =>
                        sum + product.price * (product.quantity || 1),
                    0
                );
                const shipping = subtotal > 500 ? 0 : 25;
                const tax = subtotal * 0.1;
                const total = subtotal + shipping + tax;

                document.getElementById(
                    "billSubtotal"
                ).textContent = `$${subtotal.toFixed(2)}`;
                document.getElementById("billShipping").textContent =
                    shipping === 0 ? "FREE" : `$${shipping.toFixed(2)}`;
                document.getElementById(
                    "billTax"
                ).textContent = `$${tax.toFixed(2)}`;
                document.getElementById(
                    "billTotal"
                ).textContent = `$${total.toFixed(2)}`;

                // Show modal
                const billModal = new bootstrap.Modal(
                    document.getElementById("billModal")
                );
                billModal.show();
            }

            function printBill() {
                window.print();
            }

            function confirmOrder() {
                // Clear cart
                productInCart.length = 0;

                // Close modal
                const billModal = bootstrap.Modal.getInstance(
                    document.getElementById("billModal")
                );
                billModal.hide();

                // Show success message
                showNotification(
                    "Order confirmed successfully! Thank you for your purchase.",
                    "success"
                );

                // Redirect to home after 2 seconds
                setTimeout(() => {
                    window.location.href = "index.html";
                }, 2000);
            }
        </script>
    </body>
</html>
